
mapboxgl.accessToken = 'pk.eyJ1IjoiZW5ncmtpIiwiYSI6ImNrc29yeHB2aDBieDEydXFoY240bXExcWoifQ.WS7GVtVGZb4xgHn9dleszQ';

// Main map
const mainMap = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-streets-v12',
    center: [6.5615, 46.0598],
    zoom: 2,
    pitch: 65,
    bearing: -180,
    interactive: true,
    scrollZoom: true
});

// Overview map
const overviewMap = new mapboxgl.Map({
    container: 'overviewMap',
    style: 'mapbox://styles/mapbox/satellite-streets-v12',
    center: [6.5615, 46.0598],
    zoom: 0,
    interactive: false
});
mainMap.addControl(new mapboxgl.NavigationControl());
mainMap.addControl(new mapboxgl.FullscreenControl());

const targetRoute = [
    [ 75.437096674089332, 36.850290430334383], 
[ 75.432244068067746, 36.851750580807327],
 [ 75.43000574936508, 36.85062167013983],
 [ 75.42898674109351, 36.850171022863613], 
[ 75.428112739361922, 36.847943267741861],
 [ 75.425030383356955, 36.844398174065759],
 [ 75.419990003318887, 36.843126932265591],
 [ 75.416258864289503, 36.841971103154378],
 [ 75.413403867407936, 36.842532136741823], 
[ 75.411071988529869, 36.838550987818749],
 [ 75.407427567490217, 36.839203637790533],
 [ 75.397340374361747, 36.838451124052654],
 [ 75.386901599350722, 36.837865829418767],
 [ 75.393207515533746, 36.83677365778717],
 [ 75.391580414872763, 36.834653659219079], 
[ 75.385092481040687, 36.83474805598361],
 [ 75.378069109017176, 36.833896224586091], 
[ 75.374723441980947, 36.833577898197312],
 [ 75.369554620763424, 36.830334871277827],
 [ 75.366683062435712, 36.829002535116508], 
[ 75.358883606995519, 36.824963437638011],
 [ 75.355503401730985, 36.82322751491094], 
[ 75.351817587550499, 36.820833991524943], 
[ 75.34409732546365, 36.816853840067047], 
[ 75.339257864959976, 36.81539381202392], 
[ 75.330842566759515, 36.814292742935592],
 [ 75.320832188611789, 36.816867777998318],
 [ 75.313107196901157, 36.820287074864368], 
[ 75.308076958623701, 36.823358019627321],
 [ 75.30474421698753, 36.825522139786322], 
[ 75.296855381924985, 36.82932698949454],
 [ 75.29242644024994, 36.830060041169631],
 [ 75.288950384248437, 36.828941732478881],
 [ 75.285143434363192, 36.828423730785047],
 [ 75.281695438360401, 36.830709576448058],
 [ 75.277556023149529, 36.833302161594787],
 [ 75.27221733512819, 36.833147584091193],
 [ 75.267800762907001, 36.832402370211753],
 [ 75.265211544363055, 36.834156037578687], 
[ 75.258448424454699, 36.833170377553152], 
[ 75.256139338625488, 36.832497170753548],
 [ 75.25372573374645, 36.834556100826482], 
[ 75.248337576040143, 36.835607382611528], 
[ 75.244860981066012, 36.834698400553357], 
[ 75.241953625884292, 36.834655303261698], 
[ 75.239256479147798, 36.836126695716381],
 [ 75.235335317263448, 36.837436978020783], 
[ 75.231420450527622, 36.839198295827423], 
[ 75.227021636178947, 36.842509885620217], 
[ 75.223140548751076, 36.84404520438018],
 [ 75.219232915900719, 36.845824097970493],
 [ 75.216928451267862, 36.847436162866792],
 [ 75.210370929844586, 36.848764635017183], 
[ 75.204996951795025, 36.850123782927703],
 [ 75.201441343383451, 36.852218953191347], 
[ 75.198507188006744, 36.853977057252678],
 [ 75.19487657380995, 36.85623039050666], 
[ 75.193812368231946, 36.856997412233802],
 [ 75.190906882763286, 36.858525832834758],
 [ 75.184294536617841, 36.859171601588123],
 [ 75.179577351239359, 36.860553857831839],
 [ 75.176042933619925, 36.863349028733609],
 [ 75.171823025895534, 36.865648376840689],
 [ 75.168981355875161, 36.868548649020752], 
[ 75.164498516514811, 36.874491493168918],
 [ 75.163637865322229, 36.8760253507999], 
[ 75.155155844293063, 36.874624710492107], 
[ 75.145982159501273, 36.872934123711488], 
[ 75.140499411740208, 36.873787325008053],
 [ 75.1391140443545, 36.871823270795723], 
[ 75.132823607901457, 36.87000234686522 ], 
[ 75.129408215449445, 36.869215129065168], 
[ 75.123752738725784, 36.866973860098611],
 [ 75.116934784378515, 36.866447095310953 ], 
[ 75.112076811877785, 36.867405696695272], 
[ 75.101272074493806, 36.864592020255898], 
[ 75.092809591739439, 36.86254953339941], 
[ 75.086497188256061, 36.861229124080353],
 [ 75.081508108032438, 36.86190392405787], 
[ 75.074471294326742, 36.861381404520422], 
[ 75.072511436702968, 36.859407963286159],
 [ 75.069731104923164, 36.858068105180941],
 [ 75.061638230774818, 36.857370528372321], 
[ 75.052495622605036, 36.85801700484997], 
[ 75.047925231962822, 36.859864410465313 ], 
[ 75.043626027151078, 36.859354765508243 ],
 [ 75.039053258336011, 36.859425199419597 ], 
[ 75.028654135540947, 36.859679967343958],
 [ 75.021155963344995, 36.860023292677518], 
[ 75.017829313223274, 36.860875116850544],
 [ 75.013042712608268, 36.862972673693747], 
[ 75.011637505530913, 36.864980403564743],
 [ 75.005383642793717, 36.865101486383402],
 [ 75.000106873425068, 36.862886945033218], 
[ 74.993847934550161, 36.858652073916971], 
[ 74.989100019047228, 36.85495615934984], 
[ 74.985420499002487, 36.852488612035067],
 [ 74.980518886392289, 36.849248758827478],
 [ 74.978770667759761, 36.843183454269251],
 [ 74.978967503941846, 36.841783851409517], 
[ 74.977084899684002, 36.838625040956167], 
[ 74.976524315695272, 36.836403787393692], 
[ 74.977672662282458, 36.834129264015289], 
[ 74.976662366191405, 36.83235667442959], 
[ 74.975424426834223, 36.830128641657282], 
[ 74.973508674877394, 36.828736028417403],
 [ 74.9709538226207, 36.827112684786293], 
[ 74.969325487884092, 36.825404077939133], 
[ 74.966546829741461, 36.823257368905317], 
[ 74.965292816224974, 36.821493989615], 
[ 74.963932692084242, 36.819969190124297],
 [ 74.9632928354238, 36.818888249470888], 
[ 74.963349145159555, 36.816471645645528],
 [ 74.964323269576383, 36.815313353928182], 
[ 74.964577593686457, 36.811240590120541], 
[ 74.963781880963879, 36.808202626933053],
 [ 74.961963603575413, 36.806695578063831], 
[ 74.962320955262214, 36.80467427256773],
 [ 74.961373775530049, 36.802415259824294],
 [ 74.959303524739525, 36.800363483665102],
 [ 74.959828054992713, 36.797978334271477],
 [ 74.957417344922789, 36.795324392214773], 
[ 74.953894490736403, 36.793231642453676], 
[ 74.947645147295972, 36.79381423830822],
 [ 74.942639180675826, 36.792974985195507], 
[ 74.939208493780498, 36.793923375326408],
 [ 74.934991298125411, 36.792947201876792],
 [ 74.930818622927902, 36.791541823378033],
 [ 74.926835384713129, 36.792463408590741],
 [ 74.923421566976614, 36.794022192941149], 
[ 74.918277480105047, 36.794711170302357],
 [ 74.91361950638381, 36.79470178683782], 
[ 74.910674437159258, 36.794106004390891],
 [ 74.908302427287666, 36.792168714570337],
 [ 74.906436250582658, 36.789379100788402],
 [ 74.904234666896514, 36.788334176341188],
 [ 74.899186391495135, 36.789144090867737], 
[ 74.894716948316599, 36.789514522539527],
 [ 74.890128739420362, 36.788741551428629],
 [ 74.885145248654936, 36.788006368905471], 
[ 74.879228249128218, 36.787928636983807], 
[ 74.876653610238776, 36.786703154495257],
 [ 74.875355359629879, 36.783703451956207], 
[ 74.871301556889861, 36.782483789211049],
 [ 74.867997952225593, 36.779124205654249],
 [ 74.865102899388091, 36.775943540248882], 
[ 74.863207126876191, 36.774079016193788],
 [ 74.858148680499653, 36.769007483467178],
 [ 74.853281809377506, 36.767079103220013], 
[ 74.848955965872904, 36.763560744264993],
 [ 74.849834023061618, 36.760568466617322], 
[ 74.850393528047093, 36.757110227471159],
 [ 74.846841123668597, 36.754318832209712],
 [ 74.841849608011216, 36.750639991168747],
 [ 74.838671171142892, 36.750835149220173], 
[ 74.834588656148796, 36.750876938522367], 
[ 74.833612762066565, 36.750247122834573],
 [ 74.832479274708987, 36.749769053265418], 
[ 74.83188245932952, 36.748542236626747], 
[ 74.826095474171666, 36.745738704185548],
 [ 74.823490100566389, 36.742078997098652], 
[ 74.822294648333852, 36.737813170081218],
 [ 74.821903573163524, 36.733526757819817], 
[ 74.819072800313279, 36.730074772271863],
 [ 74.815366088486172, 36.725980107746011],
 [ 74.812721720399409, 36.723894003912299], 
[ 74.809896820214576, 36.719943960335947], 
[ 74.806227831536219, 36.71556645940813], 
[ 74.807426599114521, 36.713078544939428], 
[ 74.81212340407879, 36.708263050652377],
 [ 74.81651115028653, 36.707933373437918], 
[ 74.819093016421135, 36.703381249427011], 
[ 74.820730893775917, 36.700383556260327],
 [ 74.819875380402337, 36.696831205136178], 
[ 74.819269903155956, 36.693709055180491], 
[ 74.824042573006039, 36.685258400982093], 
[ 74.8255410403805, 36.680309971315587],
 [ 74.827754950436045, 36.677864341423493], 
[ 74.831243038760576, 36.677397686836329],
 [ 74.83302295953419, 36.675969290922431],
 [ 74.834821443662122, 36.67453193050757], 
[ 74.836768684342971, 36.67333269706581],
 [ 74.839294207537307, 36.670243044446323], 
[ 74.839302699594754, 36.666057386901848], 
[ 74.83745448153995, 36.663097044927021], 
[ 74.839800300116934, 36.660181918121467],
 [ 74.844131901636743, 36.659578965032473 ], 
[ 74.846176949125478, 36.656977189157537],
 [ 74.848624568450319, 36.653711814748291],
 [ 74.848790475752224, 36.649631993574282], 
[ 74.850236447814481, 36.643815870082669],
 [ 74.850488580366957, 36.637368737565772], 
[ 74.851374246720084, 36.629040135218993], 
[ 74.852573780345182, 36.62586243162766], 
[ 74.856167386434763, 36.621839487992148],
 [ 74.859845577512274, 36.618578142916157],
 [ 74.862544183511758, 36.614018920435967],
 [ 74.864663226543811, 36.610141029684392], 
[ 74.866585576171389, 36.607909047906617], 
[ 74.867617615257345, 36.604581193957983],
 [ 74.864469157876371, 36.602476901991913],
 [ 74.861818138527781, 36.599451892570762],
 [ 74.861267018114106, 36.596399879650633],
 [ 74.859515625104009, 36.59379231679798], 
[ 74.851790288610843, 36.58978097472739],
 [ 74.846956289671198, 36.589105051837073],
 [ 74.841492372310157, 36.588845959357208], 
[ 74.838509625320171, 36.587459809700007],
 [ 74.836411159054435, 36.584818917066428 ],
 [ 74.836020222320414, 36.582951771120577],
 [ 74.834839286606254, 36.581655933326559],
 [ 74.832860132904173, 36.578488034649723], 
[ 74.829800975936095, 36.576069873515159],
 [ 74.827346113847923, 36.576654949301499],
 [ 74.826236844180841, 36.578761807204607],
 [ 74.822582338648473, 36.580069966295447],
 [ 74.818938741271836, 36.581558683126161],
 [ 74.81518034363576, 36.582822190091498], 
[ 74.806855155833446, 36.580743512238989],
 [ 74.801307655084344, 36.579760732753471],
 [ 74.799573907577823, 36.576859863431778],
 [ 74.79473731188699, 36.57399923253778],
 [ 74.791499167103211, 36.570310899038837],
 [ 74.790540455367591, 36.568118866671],
 [ 74.791218120009034, 36.565451488632966],
 [ 74.794893619593239, 36.562389016384941], 
[ 74.797637273012242, 36.556997725023891],
 [ 74.798934458793852, 36.553790143988948],
 [ 74.799411288350072, 36.550017672664723],
 [ 74.805052158780185, 36.544245756816622],
 [ 74.810454688875623, 36.542093018628599],
 [ 74.813071843659714, 36.53555122095235], 
[ 74.814031064719813, 36.532300385944943],
 [ 74.817454281302403, 36.528744117204653],
 [ 74.822206093405654, 36.527009201037629], 
[ 74.826052427591577, 36.526307282559401], 
[ 74.828566382697971, 36.526467652622031],
 [ 74.831382967078511, 36.526976481648703],
 [ 74.836846236526995, 36.526516026293137],
 [ 74.841243382392264, 36.525805350628097],
 [ 74.844622253827595, 36.524178519700712], 
[ 74.848675260759606, 36.524324386517343], 
[ 74.853064215523744, 36.525870032698649], 
[ 74.857179846221385, 36.524272927698682],
 [ 74.861082639192347, 36.522879695439521], 
[ 74.865534817805795, 36.519354327567427], 
[ 74.869153311953113, 36.51473028798452], 
[ 74.869020455050347, 36.510384750986468],
 [ 74.874046532838364, 36.50822138369648],
 [ 74.877742605726013, 36.507742067652252], 
[ 74.881750855428308, 36.504587065150339], 
[ 74.885777391698809, 36.503125814925212],
 [ 74.889640847849819, 36.501504863758797],
 [ 74.885775208274652, 36.499203253695697], 
[ 74.881597319635262, 36.496232138296428], 
[ 74.881164547337889, 36.493090504139978], 
[ 74.880538253584916, 36.488929704852531], 
[ 74.881575923197531, 36.484641941058712], 
[ 74.892121700250001, 36.473795180990663],
 [ 74.893947903048485, 36.469835031387767],
 [ 74.892857950507889, 36.466136825072113],
 [ 74.896013069295194, 36.461699247443057],
 [ 74.901653994067843, 36.458045140528277], 
[ 74.902749694923472, 36.455112030778068],
 [ 74.903027443161918, 36.450304897864918], 
[ 74.893691591750397, 36.445158704194853], 
[ 74.882013942871041, 36.437010470902173], 
[ 74.876031390693726, 36.429668811319118],
[ 74.879881330080181, 36.424063142562183], 
[ 74.884358193492517, 36.418353537528873],
 [ 74.882482710519781, 36.41175019967222], 
[ 74.877600089591539, 36.403831141145439],
 [ 74.874905866291428, 36.396685146895251],
 [ 74.869408772770484, 36.381092884378141],
 [ 74.866064988443298, 36.372589147729421], 
[ 74.860806378315615, 36.370084058793907], 
[ 74.858589655846529, 36.366011574072878], 
[ 74.856932941107118, 36.358664331878778],
 [ 74.858959027878413, 36.349349995642747], 
[ 74.863525204814877, 36.344243537415828], 
[ 74.868080129496562, 36.332542757819994], 
[ 74.871689759555281, 36.324122328347357], 
[ 74.867589322159759, 36.31914825017126], 
[ 74.855073443730504, 36.312178849781461], 
[ 74.844527724300235, 36.308184305414507], 
[ 74.837236822546899, 36.3029994950316], 
[ 74.828578888676347, 36.304836959298932], 
[ 74.81931120129552, 36.307828102449697],
 [ 74.804006290287006, 36.308937466079733],
 [ 74.791103591605918, 36.306623396621617],
 [ 74.784671921328538, 36.302138924004417], 
[ 74.778112773213863, 36.299168091641299],
 [ 74.762784797907713, 36.304246331955063],
 [ 74.761730037013649, 36.307665137279763], 
[ 74.75248698107373, 36.306063120510963], 
[ 74.740741512585288, 36.303541477897951], 
[ 74.723653710503243, 36.30083984761702],
 [ 74.714196453460701, 36.30591834786582],
 [ 74.704115511314242, 36.311540018445747], 
[ 74.68851703390358, 36.313418305238358],
 [ 74.674204768758926, 36.313828505886903],
 [ 74.652473761564536, 36.311786471500398],
 [ 74.632315415027151, 36.30865913415645], 
[ 74.62185819054821, 36.301533622279408], 
[ 74.605836491694362, 36.296060581167119], 
[ 74.61154990832857, 36.288152766975927], 
[ 74.608059437992509, 36.280250657439566], 
[ 74.59312261435565, 36.27307865019489], 
[ 74.58471531696847, 36.276893215041639], 
[ 74.57324153912397, 36.271699591729742],
 [ 74.573929370760709, 36.25774330145078], 
[ 74.564306341839455, 36.252616506768042], 
[ 74.549485943788625, 36.252225920935743], 
[ 74.542519717685764, 36.254682698960913], 
[ 74.531318082992129, 36.256945636474597],
 [ 74.522741664855644, 36.255066766049517],
 [ 74.509955499620986, 36.252802041134402],
 [ 74.506616383412108, 36.250950418861819], 
[ 74.504372805313878, 36.244558701905127],
 [ 74.494085636483845, 36.243024350365367],
 [ 74.483905664781759, 36.244796105412291], 
[ 74.471223726484922, 36.245004483553757], 
[ 74.442092872553758, 36.243518355356002],
 [ 74.430061082119664, 36.236588217710469], 
[ 74.410042384244363, 36.239120306828148], 
[ 74.400647658517116, 36.243927602602177],
 [ 74.368676283948915, 36.244971157202933],
 [ 74.36606637983175, 36.256462532041553],
 [ 74.356366243787747, 36.257551688491994],
 [ 74.350743310407992, 36.252073650533532],
 [ 74.344959426736835, 36.247208850685958], 
[ 74.327520891238464, 36.238805434234287],
 [ 74.312980427133724, 36.236610108200928],
 [ 74.306261262140723, 36.237535113848857],
 [ 74.303946163392723, 36.23265059626064 ],
 [ 74.306840985652045, 36.223582057657978 ],
 [ 74.306115755274234, 36.217423287922522],
 [ 74.310867984980206, 36.205090850777736],
 [ 74.301713287477995, 36.191445768406879],
 [ 74.291648016095735, 36.184695132783617], 
[ 74.285022229662815, 36.179993247109799],
 [ 74.28233309187155, 36.165955705838982],
 [ 74.286113751377513, 36.154107348927347], 
[ 74.291326625306667, 36.141773803924188],
 [ 74.293863586821772, 36.13059183177365],
 [ 74.298829500721183, 36.111274684908082],
 [ 74.29358921697569, 36.101053287868787],
 [ 74.292573652268644, 36.085479230226653], 
[ 74.290273211086756, 36.064668778982529],
 [ 74.290480692198159, 36.045813849781368], 
[ 74.319194642269125, 35.989549110371613],
 [ 74.332264315158369, 35.975289421706378],
 [ 74.375123859601544, 35.930794553606539],
 [ 74.408565548119469, 35.883058174233497],
 [ 74.424196628716402, 35.882523125830623],
 [ 74.473657340733979, 35.884208220503368], 
[ 74.508609456125697, 35.857902881249309],
 [ 74.520155027507457, 35.851664093468109],
 [ 74.561601172956728, 35.818962358965628], 
[ 74.562847659651752, 35.816112572344878],


  ]
  ;
const cameraRoute = [
    [ 75.437096674089332, 36.850290430334383], 
    [ 75.432244068067746, 36.851750580807327],
     [ 75.43000574936508, 36.85062167013983],
     [ 75.42898674109351, 36.850171022863613], 
    [ 75.428112739361922, 36.847943267741861],
     [ 75.425030383356955, 36.844398174065759],
     [ 75.419990003318887, 36.843126932265591],
     [ 75.416258864289503, 36.841971103154378],
     [ 75.413403867407936, 36.842532136741823], 
    [ 75.411071988529869, 36.838550987818749],
     [ 75.407427567490217, 36.839203637790533],
     [ 75.397340374361747, 36.838451124052654],
     [ 75.386901599350722, 36.837865829418767],
     [ 75.393207515533746, 36.83677365778717],
     [ 75.391580414872763, 36.834653659219079], 
    [ 75.385092481040687, 36.83474805598361],
     [ 75.378069109017176, 36.833896224586091], 
    [ 75.374723441980947, 36.833577898197312],
     [ 75.369554620763424, 36.830334871277827],
     [ 75.366683062435712, 36.829002535116508], 
    [ 75.358883606995519, 36.824963437638011],
     [ 75.355503401730985, 36.82322751491094], 
    [ 75.351817587550499, 36.820833991524943], 
    [ 75.34409732546365, 36.816853840067047], 
    [ 75.339257864959976, 36.81539381202392], 
    [ 75.330842566759515, 36.814292742935592],
     [ 75.320832188611789, 36.816867777998318],
     [ 75.313107196901157, 36.820287074864368], 
    [ 75.308076958623701, 36.823358019627321],
     [ 75.30474421698753, 36.825522139786322], 
    [ 75.296855381924985, 36.82932698949454],
     [ 75.29242644024994, 36.830060041169631],
     [ 75.288950384248437, 36.828941732478881],
     [ 75.285143434363192, 36.828423730785047],
     [ 75.281695438360401, 36.830709576448058],
     [ 75.277556023149529, 36.833302161594787],
     [ 75.27221733512819, 36.833147584091193],
     [ 75.267800762907001, 36.832402370211753],
     [ 75.265211544363055, 36.834156037578687], 
    [ 75.258448424454699, 36.833170377553152], 
    [ 75.256139338625488, 36.832497170753548],
     [ 75.25372573374645, 36.834556100826482], 
    [ 75.248337576040143, 36.835607382611528], 
    [ 75.244860981066012, 36.834698400553357], 
    [ 75.241953625884292, 36.834655303261698], 
    [ 75.239256479147798, 36.836126695716381],
     [ 75.235335317263448, 36.837436978020783], 
    [ 75.231420450527622, 36.839198295827423], 
    [ 75.227021636178947, 36.842509885620217], 
    [ 75.223140548751076, 36.84404520438018],
     [ 75.219232915900719, 36.845824097970493],
     [ 75.216928451267862, 36.847436162866792],
     [ 75.210370929844586, 36.848764635017183], 
    [ 75.204996951795025, 36.850123782927703],
     [ 75.201441343383451, 36.852218953191347], 
    [ 75.198507188006744, 36.853977057252678],
     [ 75.19487657380995, 36.85623039050666], 
    [ 75.193812368231946, 36.856997412233802],
     [ 75.190906882763286, 36.858525832834758],
     [ 75.184294536617841, 36.859171601588123],
     [ 75.179577351239359, 36.860553857831839],
     [ 75.176042933619925, 36.863349028733609],
     [ 75.171823025895534, 36.865648376840689],
     [ 75.168981355875161, 36.868548649020752], 
    [ 75.164498516514811, 36.874491493168918],
     [ 75.163637865322229, 36.8760253507999], 
    [ 75.155155844293063, 36.874624710492107], 
    [ 75.145982159501273, 36.872934123711488], 
    [ 75.140499411740208, 36.873787325008053],
     [ 75.1391140443545, 36.871823270795723], 
    [ 75.132823607901457, 36.87000234686522 ], 
    [ 75.129408215449445, 36.869215129065168], 
    [ 75.123752738725784, 36.866973860098611],
     [ 75.116934784378515, 36.866447095310953 ], 
    [ 75.112076811877785, 36.867405696695272], 
    [ 75.101272074493806, 36.864592020255898], 
    [ 75.092809591739439, 36.86254953339941], 
    [ 75.086497188256061, 36.861229124080353],
     [ 75.081508108032438, 36.86190392405787], 
    [ 75.074471294326742, 36.861381404520422], 
    [ 75.072511436702968, 36.859407963286159],
     [ 75.069731104923164, 36.858068105180941],
     [ 75.061638230774818, 36.857370528372321], 
    [ 75.052495622605036, 36.85801700484997], 
    [ 75.047925231962822, 36.859864410465313 ], 
    [ 75.043626027151078, 36.859354765508243 ],
     [ 75.039053258336011, 36.859425199419597 ], 
    [ 75.028654135540947, 36.859679967343958],
     [ 75.021155963344995, 36.860023292677518], 
    [ 75.017829313223274, 36.860875116850544],
     [ 75.013042712608268, 36.862972673693747], 
    [ 75.011637505530913, 36.864980403564743],
     [ 75.005383642793717, 36.865101486383402],
     [ 75.000106873425068, 36.862886945033218], 
    [ 74.993847934550161, 36.858652073916971], 
    [ 74.989100019047228, 36.85495615934984], 
    [ 74.985420499002487, 36.852488612035067],
     [ 74.980518886392289, 36.849248758827478],
     [ 74.978770667759761, 36.843183454269251],
     [ 74.978967503941846, 36.841783851409517], 
    [ 74.977084899684002, 36.838625040956167], 
    [ 74.976524315695272, 36.836403787393692], 
    [ 74.977672662282458, 36.834129264015289], 
    [ 74.976662366191405, 36.83235667442959], 
    [ 74.975424426834223, 36.830128641657282], 
    [ 74.973508674877394, 36.828736028417403],
     [ 74.9709538226207, 36.827112684786293], 
    [ 74.969325487884092, 36.825404077939133], 
    [ 74.966546829741461, 36.823257368905317], 
    [ 74.965292816224974, 36.821493989615], 
    [ 74.963932692084242, 36.819969190124297],
     [ 74.9632928354238, 36.818888249470888], 
    [ 74.963349145159555, 36.816471645645528],
     [ 74.964323269576383, 36.815313353928182], 
    [ 74.964577593686457, 36.811240590120541], 
    [ 74.963781880963879, 36.808202626933053],
     [ 74.961963603575413, 36.806695578063831], 
    [ 74.962320955262214, 36.80467427256773],
     [ 74.961373775530049, 36.802415259824294],
     [ 74.959303524739525, 36.800363483665102],
     [ 74.959828054992713, 36.797978334271477],
     [ 74.957417344922789, 36.795324392214773], 
    [ 74.953894490736403, 36.793231642453676], 
    [ 74.947645147295972, 36.79381423830822],
     [ 74.942639180675826, 36.792974985195507], 
    [ 74.939208493780498, 36.793923375326408],
     [ 74.934991298125411, 36.792947201876792],
     [ 74.930818622927902, 36.791541823378033],
     [ 74.926835384713129, 36.792463408590741],
     [ 74.923421566976614, 36.794022192941149], 
    [ 74.918277480105047, 36.794711170302357],
     [ 74.91361950638381, 36.79470178683782], 
    [ 74.910674437159258, 36.794106004390891],
     [ 74.908302427287666, 36.792168714570337],
     [ 74.906436250582658, 36.789379100788402],
     [ 74.904234666896514, 36.788334176341188],
     [ 74.899186391495135, 36.789144090867737], 
    [ 74.894716948316599, 36.789514522539527],
     [ 74.890128739420362, 36.788741551428629],
     [ 74.885145248654936, 36.788006368905471], 
    [ 74.879228249128218, 36.787928636983807], 
    [ 74.876653610238776, 36.786703154495257],
     [ 74.875355359629879, 36.783703451956207], 
    [ 74.871301556889861, 36.782483789211049],
     [ 74.867997952225593, 36.779124205654249],
     [ 74.865102899388091, 36.775943540248882], 
    [ 74.863207126876191, 36.774079016193788],
     [ 74.858148680499653, 36.769007483467178],
     [ 74.853281809377506, 36.767079103220013], 
    [ 74.848955965872904, 36.763560744264993],
     [ 74.849834023061618, 36.760568466617322], 
    [ 74.850393528047093, 36.757110227471159],
     [ 74.846841123668597, 36.754318832209712],
     [ 74.841849608011216, 36.750639991168747],
     [ 74.838671171142892, 36.750835149220173], 
    [ 74.834588656148796, 36.750876938522367], 
    [ 74.833612762066565, 36.750247122834573],
     [ 74.832479274708987, 36.749769053265418], 
    [ 74.83188245932952, 36.748542236626747], 
    [ 74.826095474171666, 36.745738704185548],
     [ 74.823490100566389, 36.742078997098652], 
    [ 74.822294648333852, 36.737813170081218],
     [ 74.821903573163524, 36.733526757819817], 
    [ 74.819072800313279, 36.730074772271863],
     [ 74.815366088486172, 36.725980107746011],
     [ 74.812721720399409, 36.723894003912299], 
    [ 74.809896820214576, 36.719943960335947], 
    [ 74.806227831536219, 36.71556645940813], 
    [ 74.807426599114521, 36.713078544939428], 
    [ 74.81212340407879, 36.708263050652377],
     [ 74.81651115028653, 36.707933373437918], 
    [ 74.819093016421135, 36.703381249427011], 
    [ 74.820730893775917, 36.700383556260327],
     [ 74.819875380402337, 36.696831205136178], 
    [ 74.819269903155956, 36.693709055180491], 
    [ 74.824042573006039, 36.685258400982093], 
    [ 74.8255410403805, 36.680309971315587],
     [ 74.827754950436045, 36.677864341423493], 
    [ 74.831243038760576, 36.677397686836329],
     [ 74.83302295953419, 36.675969290922431],
     [ 74.834821443662122, 36.67453193050757], 
    [ 74.836768684342971, 36.67333269706581],
     [ 74.839294207537307, 36.670243044446323], 
    [ 74.839302699594754, 36.666057386901848], 
    [ 74.83745448153995, 36.663097044927021], 
    [ 74.839800300116934, 36.660181918121467],
     [ 74.844131901636743, 36.659578965032473 ], 
    [ 74.846176949125478, 36.656977189157537],
     [ 74.848624568450319, 36.653711814748291],
     [ 74.848790475752224, 36.649631993574282], 
    [ 74.850236447814481, 36.643815870082669],
     [ 74.850488580366957, 36.637368737565772], 
    [ 74.851374246720084, 36.629040135218993], 
    [ 74.852573780345182, 36.62586243162766], 
    [ 74.856167386434763, 36.621839487992148],
     [ 74.859845577512274, 36.618578142916157],
     [ 74.862544183511758, 36.614018920435967],
     [ 74.864663226543811, 36.610141029684392], 
    [ 74.866585576171389, 36.607909047906617], 
    [ 74.867617615257345, 36.604581193957983],
     [ 74.864469157876371, 36.602476901991913],
     [ 74.861818138527781, 36.599451892570762],
     [ 74.861267018114106, 36.596399879650633],
     [ 74.859515625104009, 36.59379231679798], 
    [ 74.851790288610843, 36.58978097472739],
     [ 74.846956289671198, 36.589105051837073],
     [ 74.841492372310157, 36.588845959357208], 
    [ 74.838509625320171, 36.587459809700007],
     [ 74.836411159054435, 36.584818917066428 ],
     [ 74.836020222320414, 36.582951771120577],
     [ 74.834839286606254, 36.581655933326559],
     [ 74.832860132904173, 36.578488034649723], 
    [ 74.829800975936095, 36.576069873515159],
     [ 74.827346113847923, 36.576654949301499],
     [ 74.826236844180841, 36.578761807204607],
     [ 74.822582338648473, 36.580069966295447],
     [ 74.818938741271836, 36.581558683126161],
     [ 74.81518034363576, 36.582822190091498], 
    [ 74.806855155833446, 36.580743512238989],
     [ 74.801307655084344, 36.579760732753471],
     [ 74.799573907577823, 36.576859863431778],
     [ 74.79473731188699, 36.57399923253778],
     [ 74.791499167103211, 36.570310899038837],
     [ 74.790540455367591, 36.568118866671],
     [ 74.791218120009034, 36.565451488632966],
     [ 74.794893619593239, 36.562389016384941], 
    [ 74.797637273012242, 36.556997725023891],
     [ 74.798934458793852, 36.553790143988948],
     [ 74.799411288350072, 36.550017672664723],
     [ 74.805052158780185, 36.544245756816622],
     [ 74.810454688875623, 36.542093018628599],
     [ 74.813071843659714, 36.53555122095235], 
    [ 74.814031064719813, 36.532300385944943],
     [ 74.817454281302403, 36.528744117204653],
     [ 74.822206093405654, 36.527009201037629], 
    [ 74.826052427591577, 36.526307282559401], 
    [ 74.828566382697971, 36.526467652622031],
     [ 74.831382967078511, 36.526976481648703],
     [ 74.836846236526995, 36.526516026293137],
     [ 74.841243382392264, 36.525805350628097],
     [ 74.844622253827595, 36.524178519700712], 
    [ 74.848675260759606, 36.524324386517343], 
    [ 74.853064215523744, 36.525870032698649], 
    [ 74.857179846221385, 36.524272927698682],
     [ 74.861082639192347, 36.522879695439521], 
    [ 74.865534817805795, 36.519354327567427], 
    [ 74.869153311953113, 36.51473028798452], 
    [ 74.869020455050347, 36.510384750986468],
     [ 74.874046532838364, 36.50822138369648],
     [ 74.877742605726013, 36.507742067652252], 
    [ 74.881750855428308, 36.504587065150339], 
    [ 74.885777391698809, 36.503125814925212],
     [ 74.889640847849819, 36.501504863758797],
     [ 74.885775208274652, 36.499203253695697], 
    [ 74.881597319635262, 36.496232138296428], 
    [ 74.881164547337889, 36.493090504139978], 
    [ 74.880538253584916, 36.488929704852531], 
    [ 74.881575923197531, 36.484641941058712], 
    [ 74.892121700250001, 36.473795180990663],
     [ 74.893947903048485, 36.469835031387767],
     [ 74.892857950507889, 36.466136825072113],
     [ 74.896013069295194, 36.461699247443057],
     [ 74.901653994067843, 36.458045140528277], 
    [ 74.902749694923472, 36.455112030778068],
     [ 74.903027443161918, 36.450304897864918], 
    [ 74.893691591750397, 36.445158704194853], 
    [ 74.882013942871041, 36.437010470902173], 
    [ 74.876031390693726, 36.429668811319118],
    [ 74.879881330080181, 36.424063142562183], 
    [ 74.884358193492517, 36.418353537528873],
     [ 74.882482710519781, 36.41175019967222], 
    [ 74.877600089591539, 36.403831141145439],
     [ 74.874905866291428, 36.396685146895251],
     [ 74.869408772770484, 36.381092884378141],
     [ 74.866064988443298, 36.372589147729421], 
    [ 74.860806378315615, 36.370084058793907], 
    [ 74.858589655846529, 36.366011574072878], 
    [ 74.856932941107118, 36.358664331878778],
     [ 74.858959027878413, 36.349349995642747], 
    [ 74.863525204814877, 36.344243537415828], 
    [ 74.868080129496562, 36.332542757819994], 
    [ 74.871689759555281, 36.324122328347357], 
    [ 74.867589322159759, 36.31914825017126], 
    [ 74.855073443730504, 36.312178849781461], 
    [ 74.844527724300235, 36.308184305414507], 
    [ 74.837236822546899, 36.3029994950316], 
    [ 74.828578888676347, 36.304836959298932], 
    [ 74.81931120129552, 36.307828102449697],
     [ 74.804006290287006, 36.308937466079733],
     [ 74.791103591605918, 36.306623396621617],
     [ 74.784671921328538, 36.302138924004417], 
    [ 74.778112773213863, 36.299168091641299],
     [ 74.762784797907713, 36.304246331955063],
     [ 74.761730037013649, 36.307665137279763], 
    [ 74.75248698107373, 36.306063120510963], 
    [ 74.740741512585288, 36.303541477897951], 
    [ 74.723653710503243, 36.30083984761702],
     [ 74.714196453460701, 36.30591834786582],
     [ 74.704115511314242, 36.311540018445747], 
    [ 74.68851703390358, 36.313418305238358],
     [ 74.674204768758926, 36.313828505886903],
     [ 74.652473761564536, 36.311786471500398],
     [ 74.632315415027151, 36.30865913415645], 
    [ 74.62185819054821, 36.301533622279408], 
    [ 74.605836491694362, 36.296060581167119], 
    [ 74.61154990832857, 36.288152766975927], 
    [ 74.608059437992509, 36.280250657439566], 
    [ 74.59312261435565, 36.27307865019489], 
    [ 74.58471531696847, 36.276893215041639], 
    [ 74.57324153912397, 36.271699591729742],
     [ 74.573929370760709, 36.25774330145078], 
    [ 74.564306341839455, 36.252616506768042], 
    [ 74.549485943788625, 36.252225920935743], 
    [ 74.542519717685764, 36.254682698960913], 
    [ 74.531318082992129, 36.256945636474597],
     [ 74.522741664855644, 36.255066766049517],
     [ 74.509955499620986, 36.252802041134402],
     [ 74.506616383412108, 36.250950418861819], 
    [ 74.504372805313878, 36.244558701905127],
     [ 74.494085636483845, 36.243024350365367],
     [ 74.483905664781759, 36.244796105412291], 
    [ 74.471223726484922, 36.245004483553757], 
    [ 74.442092872553758, 36.243518355356002],
     [ 74.430061082119664, 36.236588217710469], 
    [ 74.410042384244363, 36.239120306828148], 
    [ 74.400647658517116, 36.243927602602177],
     [ 74.368676283948915, 36.244971157202933],
     [ 74.36606637983175, 36.256462532041553],
     [ 74.356366243787747, 36.257551688491994],
     [ 74.350743310407992, 36.252073650533532],
     [ 74.344959426736835, 36.247208850685958], 
    [ 74.327520891238464, 36.238805434234287],
     [ 74.312980427133724, 36.236610108200928],
     [ 74.306261262140723, 36.237535113848857],
     [ 74.303946163392723, 36.23265059626064 ],
     [ 74.306840985652045, 36.223582057657978 ],
     [ 74.306115755274234, 36.217423287922522],
     [ 74.310867984980206, 36.205090850777736],
     [ 74.301713287477995, 36.191445768406879],
     [ 74.291648016095735, 36.184695132783617], 
    [ 74.285022229662815, 36.179993247109799],
     [ 74.28233309187155, 36.165955705838982],
     [ 74.286113751377513, 36.154107348927347], 
    [ 74.291326625306667, 36.141773803924188],
     [ 74.293863586821772, 36.13059183177365],
     [ 74.298829500721183, 36.111274684908082],
     [ 74.29358921697569, 36.101053287868787],
     [ 74.292573652268644, 36.085479230226653], 
    [ 74.290273211086756, 36.064668778982529],
     [ 74.290480692198159, 36.045813849781368], 
    [ 74.319194642269125, 35.989549110371613],
     [ 74.332264315158369, 35.975289421706378],
     [ 74.375123859601544, 35.930794553606539],
     [ 74.408565548119469, 35.883058174233497],
     [ 74.424196628716402, 35.882523125830623],
     [ 74.473657340733979, 35.884208220503368], 
    [ 74.508609456125697, 35.857902881249309],
     [ 74.520155027507457, 35.851664093468109],
     [ 74.561601172956728, 35.818962358965628], 
    [ 74.562847659651752, 35.816112572344878],
    
  ]
  ;

mainMap.on('style.load', () => {
    mainMap.addSource('mapbox-dem', {
        type: 'raster-dem',
        url: 'mapbox://mapbox.mapbox-terrain-dem-v1',
        tileSize: 128,
        maxzoom: 14
    });
    mainMap.setTerrain({ source: 'mapbox-dem', exaggeration: 1.5 });
    mainMap.addSource('trace', {
        type: 'geojson',
        data: {
            type: 'Feature',
            properties: {},
            geometry: {
                type: 'LineString',
                coordinates: targetRoute
            }
        }
    });
    mainMap.addLayer({
        type: 'line',
        source: 'trace',
        id: 'line',
        paint: {
            'line-color': 'black',
            'line-width': 0.1
        },
        layout: {
            'line-cap': 'round',
            'line-join': 'round'
        }
    });
});


// Add the route to the overview map
overviewMap.on('load', () => {
    overviewMap.addSource('trace', {
        type: 'geojson',
        data: {
            type: 'Feature',
            properties: {},
            geometry: {
                type: 'LineString',
                coordinates: targetRoute
            }
        }
    });

    overviewMap.addLayer({
        type: 'line',
        source: 'trace',
        id: 'line',
        paint: {
            'line-color': 'blue',
            'line-width': 2
        }
    });

    // Add a GeoJSON source for the animation point
    overviewMap.addSource('point', {
        type: 'geojson',
        data: {
            type: 'FeatureCollection',
            features: []
        }
    });

    // Add a layer for the animation point
    overviewMap.addLayer({
        id: 'point',
        source: 'point',
        type: 'circle',
        paint: {
            'circle-color': 'red',
            'circle-radius': 6,
            'circle-stroke-width': 2,
            'circle-stroke-color': '#fff'
        }
    });
});
// Add event listener for 'load' event of mainMap
mainMap.on('style.load', () => {
    mainMap.addSource('mapbox-dem', {
        'type': 'raster-dem',
        'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
        'tileSize': 512,
        'maxzoom': 14
    });
    // add the DEM source as a terrain layer with exaggerated height
    mainMap.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
});

// mainMap.on('load', () => {
//     // Adding sources and layers with initial visibility set to 'none'
//     mainMap.addSource('veryhigh_kkh', {
//         'type': 'raster',
//         'tiles': [
//             'http://172.18.1.40:8080/geoserver/shehbaz_kkh/wms?service=WMS&version=1.1.0&request=GetMap&layers=Very_High_layer&bbox={bbox-epsg-3857}&width=768&height=558&srs=EPSG:3857&styles=&format=image/png&transparent=true'
//         ],
//         'tileSize': 256
//     });

//     mainMap.addLayer({
//         'id': 'veryhigh_kkh',
//         'type': 'raster',
//         'source': 'veryhigh_kkh',
//         'paint': { 'raster-opacity': 0.4 },
//         'layout': { 'visibility': 'none' }
//     });

//     mainMap.addSource('HIGH', {
//         'type': 'raster',
//         'tiles': [
//             'http://172.18.1.40:8080/geoserver/karakoram_final_road/wms?service=WMS&version=1.1.0&request=GetMap&layers=High&bbox={bbox-epsg-3857}&width=768&height=558&srs=EPSG:3857&styles=&format=image/png&transparent=true'
//         ],
//         'tileSize': 256
//     });

//     mainMap.addLayer({
//         'id': 'HIGH',
//         'type': 'raster',
//         'source': 'HIGH',
//         'paint': { 'raster-opacity': 0.4 },
//         'layout': { 'visibility': 'none' }
//     });

//     mainMap.addSource('low', {
//         'type': 'raster',
//         'tiles': [
//             'http://172.18.1.40:8080/geoserver/karakoram_final_road/wms?service=WMS&version=1.1.0&request=GetMap&layers=Low&bbox={bbox-epsg-3857}&width=768&height=558&srs=EPSG:3857&styles=&format=image/png&transparent=true'
//         ],
//         'tileSize': 256
//     });

//     mainMap.addLayer({
//         'id': 'low',
//         'type': 'raster',
//         'source': 'low',
//         'paint': { 'raster-opacity': 0.4 },
//         'layout': { 'visibility': 'none' }
//     });

//     mainMap.addSource('verylow', {
//         'type': 'raster',
//         'tiles': [
//             'http://172.18.1.40:8080/geoserver/shehbaz_kkh/wms?service=WMS&version=1.1.0&request=GetMap&layers=shehbaz_Very_Low_layer&bbox={bbox-epsg-3857}&width=768&height=558&srs=EPSG:3857&styles=&format=image/png&transparent=true'
//         ],
//         'tileSize': 256
//     });

//     mainMap.addLayer({
//         'id': 'verylow',
//         'type': 'raster',
//         'source': 'verylow',
//         'paint': { 'raster-opacity': 0.4 },
//         'layout': { 'visibility': 'none' }
//     });

mainMap.on('load', function () {
    mainMap.addSource('currentveryhigh', {
        type: 'geojson',
        data: veryhighmor // Assuming 'veryhighdonekkh' is a variable holding GeoJSON data
    });

    mainMap.addLayer({
        'id': 'currentveryhigh',
        'type': 'fill',
        'source': 'currentveryhigh',
        'paint': {
            'fill-color': 'red', // Set fill color to red
            'fill-outline-color': 'red', // Add black outline
            'fill-opacity': 0.4, // Adjust opacity as needed (value between 0 and 1)
        },
        'layout': {
            'visibility': 'visible'
        }
    });
});
mainMap.on('load', function () {
    mainMap.addSource('currenthigh', {
        type: 'geojson',
        data: highmor// Assuming 'veryhighdonekkh' is a variable holding GeoJSON data
    });

    mainMap.addLayer({
        'id': 'currenthigh',
        'type': 'fill',
        'source': 'currenthigh',
        'paint': {
            'fill-color': 'orange', // Set fill color to red
            'fill-outline-color': 'orange', // Add black outline
            'fill-opacity': 0.4, // Adjust opacity as needed (value between 0 and 1)
        },
        'layout': {
            'visibility': 'visible'
        }
    });
});
mainMap.on('load', function () {
    mainMap.addSource('currentlow', {
        type: 'geojson',
        data: low_mor // Assuming 'veryhighdonekkh' is a variable holding GeoJSON data
    });

    mainMap.addLayer({
        'id': 'currentlow',
        'type': 'fill',
        'source': 'currentlow',
        'paint': {
            'fill-color': 'green', // Set fill color to red
            'fill-outline-color': 'green', // Add black outline
            'fill-opacity': 0.4, // Adjust opacity as needed (value between 0 and 1)
        },
        'layout': {
            'visibility': 'visible'
        }
    });
});

    // Toggle layers visibility
    document.getElementById('toggleButton').addEventListener('click', function() {
        var layers = ['currentveryhigh', 'currenthigh', 'currentlow'];
        layers.forEach(function(layer) {
            var visibility = mainMap.getLayoutProperty(layer, 'visibility');
            if (visibility === 'none') {
                mainMap.setLayoutProperty(layer, 'visibility', 'visible');
            } else {
                mainMap.setLayoutProperty(layer, 'visibility', 'none');
            }
        });
    });



    let animationDuration = 1000000;
    const cameraAltitude = 12000;
    let start = null;
    let animationFrameId = null;
    let paused = true;
    let phase = 1; // Start phase at 1 (end of route)
    const tenSecondsInPhase = 10000 / animationDuration;
    
    const slider = document.getElementById('slider');
    slider.addEventListener('input', () => {
        const sliderValue = parseInt(slider.value, 10);
        animationDuration = 200000 - (sliderValue * 20000);
        if (animationFrameId) {
            start = performance.now() - (phase * animationDuration);
        }
    });
    
    function frame(time) {
        if (!start) start = time;
        if (!paused) {
            phase = 1 - (time - start) / animationDuration; // Reverse phase calculation
        }
    
        if (phase < 0) {
            setTimeout(() => {
                start = 0.0;
                phase = 1;
                window.requestAnimationFrame(frame);
            }, 1500);
            return;
        }
    
        const routeDistance = turf.length(turf.lineString(targetRoute));
        const cameraRouteDistance = turf.length(turf.lineString(cameraRoute));
    
        const alongRoute = turf.along(
            turf.lineString(targetRoute),
            routeDistance * phase
        ).geometry.coordinates;
    
        const alongCamera = turf.along(
            turf.lineString(cameraRoute),
            cameraRouteDistance * phase
        ).geometry.coordinates;
    
        const cameraOffset = {
            lng: alongCamera[0] + 0.02,
            lat: alongCamera[1] + 0.02
        };
    
        const camera = mainMap.getFreeCameraOptions();
    
        camera.position = mapboxgl.MercatorCoordinate.fromLngLat(
            {
                lng: cameraOffset.lng,
                lat: cameraOffset.lat
            },
            cameraAltitude
        );
    
        camera.lookAtPoint({
            lng: alongRoute[0],
            lat: alongRoute[1]
        });
    
        mainMap.setFreeCameraOptions(camera);
    
        if (!paused) {
            animationFrameId = window.requestAnimationFrame(frame);
        }
    
        // Update the position of the red marker on the overview map
        overviewMap.getSource('point').setData({
            type: 'FeatureCollection',
            features: [{
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: alongRoute // Use the alongRoute coordinates for the red marker
                }
            }]
        });
    }
    
    function startAnimation() {
        if (paused) {
            paused = false;
            if (phase <= 0) {
                phase = 1;
                start = performance.now();
            }
            animationFrameId = window.requestAnimationFrame(frame);
        }
    }
    
    function pauseAnimation() {
        if (!paused) {
            paused = true;
        }
    }
    
    function stopAnimation() {
        paused = true;
        start = null;
        phase = 1;
    }
    
    function moveBackward() {
        if (paused) {
            phase -= tenSecondsInPhase;
            if (phase < 0) {
                phase = 0;
            }
            const timeSinceStart = performance.now() - start;
            start = performance.now() - (animationDuration * phase) / (1 + timeSinceStart / animationDuration);
            animationFrameId = window.requestAnimationFrame(frame);
        }
    }
    
    function moveForward() {
        if (paused) {
            phase += tenSecondsInPhase;
            if (phase > 1) {
                phase = 1;
            }
            const timeSinceStart = performance.now() - start;
            start = performance.now() - (animationDuration * phase) / (1 + timeSinceStart / animationDuration);
            animationFrameId = window.requestAnimationFrame(frame);
        }
    }
    
    document.getElementById('startButton').addEventListener('click', startAnimation);
    document.getElementById('pauseButton').addEventListener('click', pauseAnimation);
    document.getElementById('stopButton').addEventListener('click', stopAnimation);
    document.getElementById('backwardButton').addEventListener('click', moveBackward);
    document.getElementById('forwardButton').addEventListener('click', moveForward);
    document.getElementById('startButton').click(); // Start animation by default
    
    // Update the overview map viewport to focus on the route and animated point
    function updateOverviewMap() {
        const bounds = turf.bbox(turf.lineString(targetRoute));
        overviewMap.fitBounds(bounds, {
            padding: 50,
            linear: true
        });
    }
    
    // Update the overview map viewport initially
    updateOverviewMap();
    
    // Update the overview map viewport on each frame to track the animated point
    mainMap.on('render', () => {
        const point = turf.along(turf.lineString(targetRoute), turf.length(turf.lineString(targetRoute)) * phase, {units: 'kilometers'});
        const center = point.geometry.coordinates;
        overviewMap.jumpTo({ center: center, zoom: 6 });
    
        // Update the position of the red marker on the overview map
        overviewMap.getSource('point').setData({
            type: 'FeatureCollection',
            features: [{
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: center
                }
            }]
        });
    });
    
mainMap.on('load', () => {
    // Add a data source containing landslide inventory
    mainMap.addSource('landslide_inventory', {
        'type': 'geojson',
        'data': pointa_point // Ensure 'pointa_point' is defined elsewhere with valid GeoJSON
    });

    // Add a circle layer with enhanced styling
    mainMap.addLayer({
        'id': 'landslide_points',
        'type': 'circle',
        'source': 'landslide_inventory',
        'layout': {
            'visibility': 'visible' // Initially visible
        },
        'paint': {
            'circle-radius': [
                'match',
                ['get', 'landslid_2'], 
                'very_high', 38,  
                'large', 16,       
                'medium', 10,       
                'small', 7,        
                4 // Default size
            ],
            'circle-color': [
                'match',
                ['get', 'landslid_2'],
                'very_high', '#e75d0a',  // Dark Red
                'large', '#950505',       // Firebrick
                'medium', '#e75d0a',     // Dark Goldenrod
                'small', '#fbfafb',      // Dark Olive Green
                '#808080'                // Default Dark Gray
            ],
            'circle-opacity': 1, // Full opacity
            'circle-stroke-width': 2, // Increased stroke width for depth
            'circle-stroke-color': '#000000', // Black stroke for contrast
            'circle-translate': [1, 1], // Subtle shadow effect
            'circle-blur': 0.1 // Slight glow to enhance 3D feel
        }
    });

    console.log('Landslide points layer added with enhanced styling');

    // Popup on click event to display feature data
    mainMap.on('click', 'landslide_points', (e) => {
        const properties = e.features[0].properties;

        // Create an HTML table to display the data
        const popupContent = `
            <div style="font-family: Arial, sans-serif; font-size: 16px; max-width: 350px;">
                <table style="border-collapse: collapse; width: 100%; font-size: 14px; table-layout: fixed;">
                    <colgroup>
                        <col style="width: 40%;">
                        <col style="width: 60%;">
                    </colgroup>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Event Time</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.event_time || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Event Title</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.event_titl || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Event Description</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.event_desc || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Reason</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.landslid_1 || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Intensity</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.landslid_2 || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Area</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.landslid_3 || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Fatalities</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.fatality_c || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 8px; border: 1px solid black;">Injuries</td>
                        <td style="padding: 8px; border: 1px solid black;">${properties.injury_cou || 'N/A'}</td>
                    </tr>
                </table>
            </div>
        `;

        new mapboxgl.Popup()
            .setLngLat([parseFloat(properties.longitude), parseFloat(properties.latitude)])
            .setHTML(popupContent)
            .addTo(mainMap);
    });

    // Change cursor to pointer when hovering over points
    mainMap.on('mouseenter', 'landslide_points', () => {
        mainMap.getCanvas().style.cursor = 'pointer';
    });

    // Reset cursor when not hovering over points
    mainMap.on('mouseleave', 'landslide_points', () => {
        mainMap.getCanvas().style.cursor = '';
    });
});

////////////////////////////////////////////////////////////////////////////////////////////////////////////

mainMap.on('load', function () {
    mainMap.addSource('landslidetypes', {
        type: 'geojson',
        data: types // Assuming 'types' is a variable holding GeoJSON data
    });

    mainMap.addLayer({
        'id': 'landslidetypes',
        'type': 'fill',
        'source': 'landslidetypes',
        'paint': {
            'fill-color': [
                'match',
                ['get', 'Name'], // Get the 'Name' property from the feature
                'Scree', '#A10AAB', // If 'Name' is 'Scree', color it brown
                'Debris Flow', '#640EB9', // If 'Name' is 'Debris Flow', color it blue
                'Debris Fall', '#1597F0 ', // If 'Name' is 'Debris Fall', color it green
                'Debris Slide', '#15EDF0', // If 'Name' is 'Debris Slide', color it red
                'Rock Fall', '#11DF9D', // If 'Name' is 'Rock Fall', color it yellow
                'Complex Slide','#A4DF11', // If 'Name' is 'Complex Slide', color it purple
                /* default */ '#F5077E' // Fallback color if 'Name' doesn't match any of the above
            ],
            'fill-outline-color': 'red', // Set the outline color to red
            'fill-opacity': 0.3 // Adjust opacity as needed (value between 0 and 1)
        },
        'layout': {
            'visibility': 'visible'
        }
    });

    // Variable to track opacity state
    let isBlinking = true;

    // Function to toggle the fill-opacity
    function toggleOpacity() {
        mainMap.setPaintProperty(
            'landslidetypes',
            'fill-opacity',
            isBlinking ? 0.1 : 0.3 // Toggle between 0.1 and 0.4 opacity
        );
        isBlinking = !isBlinking; // Flip the blinking state
    }

    // Set interval to toggle the opacity every 500ms (adjust as needed)
    setInterval(toggleOpacity, 500);
});
  // Toggle layers visibility
  document.getElementById('toggleButton1').addEventListener('click', function() {
    var layers = ['landslidetypes'];
    layers.forEach(function(layer) {
        var visibility = mainMap.getLayoutProperty(layer, 'visibility');
        if (visibility === 'none') {
            mainMap.setLayoutProperty(layer, 'visibility', 'visible');
        } else {
            mainMap.setLayoutProperty(layer, 'visibility', 'none');
        }
    });
});

  document.getElementById('toggleButton1').addEventListener('click', function() {
    var layers = ['landslidetypes'];
    layers.forEach(function(layer) {
        var visibility = mainMap.getLayoutProperty(layer, 'visibility');
        if (visibility === 'none') {
            mainMap.setLayoutProperty(layer, 'visibility', 'visible');
        } else {
            mainMap.setLayoutProperty(layer, 'visibility', 'none');
        }
    });
});